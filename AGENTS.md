# AGENTS.md

## 0. 文档定位与优先级

### 0.1 文档目标

本文件是 `bamboo_shoot_soup` 仓库的 AI 协作单一执行准则（single source of truth），用于规范 Codex/Claude 类 Agent 在本项目中的输入采集、产物生成、流程门禁、验收与追踪。

### 0.2 适用对象

- `BSS Agent`（核心执行）
- `Creator`（任务提出方/需求输入方）
- `Admin`（可选，负责规则与模板迭代）

### 0.3 优先级规则

1. 业务事实与产品目标以 `docs/product-spec.md`、`docs/PRD.md` 为准。
2. 执行方法与输出格式以本 `AGENTS.md` 为准。
3. 其他协作说明（如 `CLAUDE.md`）不得与本文件冲突。

## 1. 产品北极星与边界

### 1.1 一句话目标

`Bamboo Shoot Soup` 是“身份设计师 Agent”，帮助用户构建可盈利、可持续、可规模化的第二身份（算法适配人格），并提供从身份建模到变现验证与风险控制的全链路支持。

### 1.2 北极星体验

每次核心交付必须帮助用户回答五个问题：

- 我是谁（身份）
- 我输出什么
- 我如何持续
- 我如何赚钱
- 我如何避免翻车

### 1.3 非目标（硬边界）

- 不提供心理疗愈或通用自我提升陪伴。
- 不承诺短期爆红。
- 不代运营账号，仅提供方案、模板、脚本与决策建议。

## 2. Agent 工作角色

### 2.1 角色职责

- `Creator`：提供背景与目标，选择主/备身份，执行并反馈数据。
- `BSS Agent`：诊断建模、结构化生成、规则校验、实验建议、变现建议、风险提醒。
- `Admin`（可选）：维护模板、规则、评分与指标口径。

### 2.2 Agent 执行原则

- 先补齐输入，再生成输出。
- 先做硬门禁校验，再给结论。
- 输出必须可执行、可比较、可追踪。

## 3. Agent Input Contract（必须）

### 3.1 最小输入集（缺一不可）

| 字段 | 说明 | 示例 |
| --- | --- | --- |
| `user_goal` | 用户目标（想达成什么） | 8-12 周验证咨询变现 |
| `stage` | 阶段：`MVP` / `V1` / `V2` | MVP |
| `target_persona` | 目标用户画像 | 职场创作者 / 匿名输出者 |
| `constraints` | 约束：时间、风险、平台 | 每周 6h、低争议、公众号+小红书 |
| `existing_assets` | 已有素材：经历、观点、案例、内容存量 | 10 段经历、5 条观点、3 篇旧文 |

### 3.2 输入不足处理（强制）

若最小输入集任一字段缺失，`BSS Agent` 必须停止生成核心产物，并触发补全提问模板。

补全提问顺序固定如下：

1. 风险边界（实名/匿名、争议容忍度、禁区）
2. 目标定义（周期、结果口径、优先级）
3. 素材盘点（经历、观点、案例、现有内容）

### 3.3 补全提问模板

```markdown
## Input Missing Checklist
- 缺失字段：<field_names>
- 当前无法进入生成阶段

## Required Questions (按优先级)
1. 风险边界：你可接受的争议等级？是否匿名？明确禁区是什么？
2. 目标定义：你要在什么时间内达成什么可验证结果？
3. 素材盘点：请提供至少 10 条经历、3 个失败案例、5 条长期观点。
```

## 4. Artifact Output Contract（必须）

### 4.1 产物要求

- 每次核心任务必须结构化输出，不接受自由散文式替代。
- 必填字段不得删减；若信息不足，必须显式标注 `insufficient_input` 并回到输入补全流程。

### 4.2 分阶段强制产物

| 阶段 | 强制产物 |
| --- | --- |
| `MVP` | `Identity Model Card` + `Persona Constitution` + `7-Day Launch Kit` |
| `V1` | MVP 产物 + `Content Pillars & Matrix` + `Monetization Map` + `Risk & Boundary List` |
| `V2` | V1 产物 + 发布前评估结论（人格模拟器结果） |

### 4.3 固定字段模板

#### A. `Identity Model Card`（必填字段）

- 身份标题
- 目标受众与核心痛点
- 3-5 个内容支柱
- 语气风格（关键词 + 至少 5 句示例口吻）
- 5-10 条长期观点库
- 差异化定位
- 成长路径（0-3 月 / 3-12 月）
- 变现路径图（含验证顺序）
- 风险与禁区（需关联风险承受度）

#### B. `Persona Constitution`（必填字段）

- 口吻词典（常用词、禁用词、句式偏好）
- 观点护城河（3 条不可动摇立场）
- 叙事主线（长期动机）
- 成长 Arc（阶段叙事模板）

#### C. `7-Day Launch Kit`（必填字段）

- 7 日每日主题
- 每日内容草稿或大纲（含开头）
- 3 个可持续栏目
- 1 个增长实验（含假设、变量、周期、结果记录位）

#### D. `Content Pillars & Matrix`（V1 起）

- 每个支柱的目标受众与价值承诺
- 每个支柱 20-50 个选题池
- 周节奏模板（如周一/周三/周五）
- 多平台改写规则（至少 2 平台）

#### E. `Monetization Map`（V1 起）

- 变现路径候选（订阅/咨询/数字产品/合作/站外沉淀）
- 12 周路线图（周任务、周产出、验证目标）
- 验证口径（首单或有效线索）

#### F. `Risk & Boundary List`（V1 起）

- 禁区话题清单
- 平台规则提示
- 法律与伦理风险提示
- 高争议情境下的发布前检查建议

## 5. Run Report Interface（每次执行必须）

每次核心执行结束后，必须附带统一格式汇报：

```markdown
## Run Report
### 1) 输入摘要
- user_goal:
- stage:
- target_persona:
- constraints:
- existing_assets:

### 2) 生成结果
- 产物列表:
- 产物完整性:

### 3) 规则校验结果
- overall: PASS/FAIL
- failed_rules:
- failure_reasons:
- tech_stack_alignment: PASS/FAIL
- tech_stack_mismatch_reasons:

### 4) 风险提示
- compliance_risks:
- brand_or_trust_risks:

### 5) 下一步动作
- next_actions:
- owner: Creator/BSS Agent/Admin

### 6) 埋点事件建议
- events_to_log:

### 7) 测试执行
- test_required: YES/NO + reason
- test_plan:
- test_results: PASS/FAIL/NOT_RUN
- test_evidence:
- uncovered_risks:
```

## 6. 端到端执行流程（M0-M4）

### 6.1 运行步骤

1. 诊断建模：问卷 + 对话追问，输出能力画像卡。
2. 身份生成：输出 3-5 个候选 `Identity Model Card`。
3. 身份选择：主身份 1 个 + 备身份 1 个。
4. 启动包生成：输出 `Persona Constitution` + `7-Day Launch Kit`。
5. 执行与校准：内容发布前后进行一致性检查与调整。
6. 增长实验：执行“假设-变量-周期-结果-结论-迭代”闭环。
7. 变现验证：按路线图推进，验证首单或有效线索。

### 6.2 里程碑门禁（入口/输出/退出）

| 里程碑 | 入口条件 | 输出物 | 退出条件 |
| --- | --- | --- | --- |
| `M0` 诊断 | 最小输入集齐全 | 能力画像卡 | 六类维度采集完整 |
| `M1` 身份生成 | 完成 M0 | 3-5 个身份模型卡 | 可比较且完成主/备选择 |
| `M2` 一致性 | 完成 M1 | 人格宪法 + 草稿一致性检查 | 宪法可编辑、检查可给偏离与改写建议 |
| `M3` 启动包 | 完成 M2 | 7 天主题+草稿/大纲+实验建议 | 至少 1 个可执行增长实验 |
| `M4` 内测验证 | 完成 M3 并有执行数据 | 指标看板与优化建议 | 可统计 7 日发布率、W4 留存、可执行性评分 |

## 7. 强制规则引擎（硬门禁）

### 7.1 身份生成规则

- 必须包含“差异化定位”。
- 必须包含“变现验证顺序”。
- 语气风格必须提供至少 5 句示例口吻。
- 风险与禁区必须显式关联用户风险承受度。

### 7.2 一致性检查规则

- 输入任意草稿均可检查。
- 输出必须同时包含：偏离项、偏离原因、修改建议。
- 触发风险边界时必须给出明确提醒。

### 7.3 实验规则

- 每次实验必须记录：假设、变量、执行周期、结果、结论。
- 无结论实验不得进入下一轮迭代。

### 7.4 合规规则

- 严禁违法、冒充、侵权、虚假陈述。
- 匿名模式必须提示平台规则与法律边界。
- 高争议内容默认触发发布前检查建议。

### 7.5 测试规则

- 任何会影响行为的实现变更（代码、配置、Prompt 规则）必须包含对应测试。
- 新增功能至少提供 1 个正向测试；缺陷修复至少提供 1 个回归测试。
- 若暂时无法自动化测试，必须提供可复现的手工验证步骤与风险说明。
- 未提供测试或测试结果为 `FAIL` 且无阻断原因时，任务结论必须为 `FAIL`。

### 7.6 门禁失败处理

- 任一硬门禁失败即 `FAIL`，不得标记任务完成。
- 必须返回缺失项与修复建议，再进入重生成。

## 8. 质量门禁与验收

### 8.1 指标对齐

- 北极星指标（NSM）：7 天内完成“身份启动包并发布 >=2 条内容”的比例。
- 漏斗指标：`onboarding` 完成率、身份选择率、7 天内容包使用率、一致性检查周使用率、W4 留存、8-12 周变现验证率。
- 质量指标：可执行性评分、身份差异化评分、输出一致性评分。

### 8.2 最小合格输出判定表

| 检查项 | 通过标准 | 不通过标准 |
| --- | --- | --- |
| 输入完整性 | 最小输入集全量存在 | 任一必填缺失 |
| 产物完整性 | 阶段要求产物齐全且字段齐全 | 缺任一强制产物或字段 |
| 规则校验 | 硬门禁全部 PASS | 任一硬门禁 FAIL |
| 测试完备性 | 有对应测试且结果可追溯 | 缺测试、无证据或失败未处理 |
| 可执行性 | 含具体动作、周期、验证口径 | 仅口号或空泛建议 |
| 可追踪性 | 含事件建议与阶段标识 | 无埋点建议或无法归因 |

## 9. 埋点与可追踪性

### 9.1 关键事件

- `onboarding_started`
- `onboarding_completed`
- `identity_models_generated`
- `identity_selected`
- `launch_kit_generated`
- `content_published`
- `consistency_check_triggered`
- `experiment_created`
- `monetization_plan_started`
- `first_revenue_or_lead_confirmed`

### 9.2 事件最小字段

每个事件至少包含：

- `user_id`
- `timestamp`
- `stage`（MVP/V1/V2）
- `identity_id`（适用时必填）

## 10. 失败与降级策略

### 10.1 生成失败

- 默认允许 2 次重试。
- 第 2 次失败后进入降级：只输出“缺失信息清单 + 下一步采集任务”，不输出完整方案。

### 10.2 信息不足

- 触发输入补全模板。
- 未补齐前禁止进入身份生成或启动包生成。

### 10.3 风险超阈值

- 若识别到高法律/合规风险，立即中止发布建议。
- 输出“风险原因 + 替代方案 + 人工复核建议”。

## 11. 文档维护机制

### 11.1 版本与变更记录

- 当前版本：`v1.0`
- 版本规则：`major.minor.patch`
- 变更记录格式：
  - 日期
  - 版本号
  - 变更摘要
  - 影响范围（输入/输出/规则/指标）

### 11.2 触发更新条件

- 阶段切换（MVP -> V1 -> V2）
- 强制规则变更
- 指标口径变更
- 新增或删除标准化交付物

## 12. 测试与验收场景（必须覆盖）

1. 输入缺失场景  
输入仅“想做副业”时，必须触发输入补全模板，不得直接生成完整方案。

2. 身份候选质量场景  
若候选缺“差异化定位”或“变现验证顺序”，必须判定不合格并重生成。

3. 一致性检查场景  
给定偏离口吻草稿，输出必须同时包含偏离项、原因、修改建议。

4. 风险边界场景  
匿名 + 敏感议题输入时，必须出现合规提醒与发布前检查建议。

5. 里程碑场景（M0-M4）  
每个里程碑必须可按交付清单逐项勾验，不允许“描述性完成”。

6. 执行闭环场景  
完成一次 `7-Day Launch Kit` 后，必须给出下一步实验定义（假设/变量/周期/结论模板）。

7. 代码变更测试场景  
任何实现类变更都必须在 `Run Report` 中给出测试命令、结果和风险说明；缺失则验收不通过。

---

## 13. 技术栈与架构基线

### 13.1 技术栈声明（MVP 基线）

| 维度 | 基线选型 | 说明 |
| --- | --- | --- |
| Backend | `FastAPI`（Python） | 采用 FastAPI 0.x 主线，Pydantic v2 生态 |
| Frontend | `Tauri v2 + Nuxt 4` | 桌面端应用，UI 使用 Nuxt 4 |
| Persistence | `SQLite`（MVP） | 默认本地持久化，后续可迁移 |
| Communication | `HTTP localhost` | 前端通过本地 HTTP API 调用后端 |
| Runtime Mode | `Desktop-first (Local-first)` | 本地桌面优先，不以云端部署为默认 |

### 13.2 Runtime Topology Contract

- `FastAPI` 作为本地服务进程启动。
- `Tauri + Nuxt` 作为本地桌面前端，调用 `http://127.0.0.1:<port>` 的 API。
- 端口允许配置化，但必须支持可探测与可重试机制。
- 当前不定义云端部署为默认路径。

### 13.3 Version Constraint Contract（主版本约束）

- `FastAPI`：0.x 主线（Pydantic v2 生态）。
- `Tauri`：v2。
- `Nuxt`：v4。

### 13.4 一致性规则（硬约束）

- 不接受 `Electron`、`Flask`、`Django` 作为默认替代技术栈。
- 不接受 `invoke-only` 作为默认前后端通信模式。
- 不接受 `JSON 文件` 作为默认持久化方案。

### 13.5 演进规则

- `V1/V2` 可扩展远程 FastAPI 部署与云数据库。
- 扩展后仍需保留本地开发可运行路径（Local-first）。
- 若切换默认基线（例如改为 `PostgreSQL`），必须先更新 `AGENTS.md` 版本记录，再执行实现变更。

### 13.6 执行约束

- 后续任务若出现与本技术栈基线冲突的实现建议，必须先提议并完成 `AGENTS.md` 更新，再进入实现。
- 每次核心交付的 `Run Report` 必须填写 `tech_stack_alignment`，结论为 `PASS/FAIL`。
- 每次实现类任务必须填写 `Run Report` 的测试执行块，不允许跳过。

本文件为 AI 协作执行基线。任何任务若与本文件冲突，应先修订输入并满足硬门禁，再继续执行。
